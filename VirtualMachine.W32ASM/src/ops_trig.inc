
	.data

; Figures multiplied by 32767

trig_SineTable:
	dw	0, 571, 1143, 1714, 2285, 2855, 3425, 3993, 4560, 5125, 5689, 6252, 6812, 7370, 7927, 8480, 9031, 9580, 10125, 10667, 11206, 11742, 12274, 12803, 13327, 13847, 14364, 14875, 15383, 15885, 16383, 16876, 17363, 17846, 18323, 18794
	dw	19259, 19719, 20173, 20620, 21062, 21497, 21925, 22347, 22761, 23169, 23570, 23964, 24350, 24729, 25100, 25464, 25820, 26168, 26509, 26841, 27165, 27480, 27787, 28086, 28377, 28658, 28931, 29195, 29450, 29696, 29934, 30162, 30381, 30590, 30790, 30981
	dw	31163, 31335, 31497, 31650, 31793, 31927, 32050, 32164, 32269, 32363, 32448, 32522, 32587, 32642, 32687, 32722, 32747, 32762, 32767, 32762, 32747, 32722, 32687, 32642, 32587, 32522, 32448, 32363, 32269, 32164, 32050, 31927, 31793, 31650, 31497, 31335
	dw	31163, 30981, 30790, 30590, 30381, 30162, 29934, 29696, 29450, 29195, 28931, 28658, 28377, 28086, 27787, 27480, 27165, 26841, 26509, 26168, 25820, 25464, 25100, 24729, 24350, 23964, 23570, 23169, 22761, 22347, 21925, 21497, 21062, 20620, 20173, 19719
	dw	19259, 18794, 18323, 17846, 17363, 16876, 16383, 15885, 15383, 14875, 14364, 13847, 13327, 12803, 12274, 11742, 11206, 10667, 10125, 9580, 9031, 8480, 7927, 7370, 6812, 6252, 5689, 5125, 4560, 3993, 3425, 2855, 2285, 1714, 1143, 571
	dw	0, -572, -1144, -1715, -2286, -2856, -3426, -3994, -4561, -5126, -5690, -6253, -6813, -7371, -7928, -8481, -9032, -9581, -10126, -10668, -11207, -11743, -12275, -12804, -13328, -13848, -14365, -14876, -15384, -15886, -16384, -16877, -17364, -17847, -18324, -18795
	dw	-19260, -19720, -20174, -20621, -21063, -21498, -21926, -22348, -22762, -23170, -23571, -23965, -24351, -24730, -25101, -25465, -25821, -26169, -26510, -26842, -27166, -27481, -27788, -28087, -28378, -28659, -28932, -29196, -29451, -29697, -29935, -30163, -30382, -30591, -30791, -30982
	dw	-31164, -31336, -31498, -31651, -31794, -31928, -32051, -32165, -32270, -32364, -32449, -32523, -32588, -32643, -32688, -32723, -32748, -32763, -32767, -32763, -32748, -32723, -32688, -32643, -32588, -32523, -32449, -32364, -32270, -32165, -32051, -31928, -31794, -31651, -31498, -31336
	dw	-31164, -30982, -30791, -30591, -30382, -30163, -29935, -29697, -29451, -29196, -28932, -28659, -28378, -28087, -27788, -27481, -27166, -26842, -26510, -26169, -25821, -25465, -25101, -24730, -24351, -23965, -23571, -23170, -22762, -22348, -21926, -21498, -21063, -20621, -20174, -19720
	dw	-19260, -18795, -18324, -17847, -17364, -16877, -16384, -15886, -15384, -14876, -14365, -13848, -13328, -12804, -12275, -11743, -11207, -10668, -10126, -9581, -9032, -8481, -7928, -7371, -6813, -6253, -5690, -5126, -4561, -3994, -3426, -2856, -2286, -1715, -1144, -572

trig_CosineTable:
	dw	32767, 32762, 32747, 32722, 32687, 32642, 32587, 32522, 32448, 32363, 32269, 32164, 32050, 31927, 31793, 31650, 31497, 31335, 31163, 30981, 30790, 30590, 30381, 30162, 29934, 29696, 29450, 29195, 28931, 28658, 28377, 28086, 27787, 27480, 27165, 26841
	dw	26509, 26168, 25820, 25464, 25100, 24729, 24350, 23964, 23570, 23169, 22761, 22347, 21925, 21497, 21062, 20620, 20173, 19719, 19259, 18794, 18323, 17846, 17363, 16876, 16383, 15885, 15383, 14875, 14364, 13847, 13327, 12803, 12274, 11742, 11206, 10667
	dw	10125, 9580, 9031, 8480, 7927, 7370, 6812, 6252, 5689, 5125, 4560, 3993, 3425, 2855, 2285, 1714, 1143, 571, 0, -572, -1144, -1715, -2286, -2856, -3426, -3994, -4561, -5126, -5690, -6253, -6813, -7371, -7928, -8481, -9032, -9581
	dw	-10126, -10668, -11207, -11743, -12275, -12804, -13328, -13848, -14365, -14876, -15384, -15886, -16384, -16877, -17364, -17847, -18324, -18795, -19260, -19720, -20174, -20621, -21063, -21498, -21926, -22348, -22762, -23170, -23571, -23965, -24351, -24730, -25101, -25465, -25821, -26169
	dw	-26510, -26842, -27166, -27481, -27788, -28087, -28378, -28659, -28932, -29196, -29451, -29697, -29935, -30163, -30382, -30591, -30791, -30982, -31164, -31336, -31498, -31651, -31794, -31928, -32051, -32165, -32270, -32364, -32449, -32523, -32588, -32643, -32688, -32723, -32748, -32763
	dw	-32767, -32763, -32748, -32723, -32688, -32643, -32588, -32523, -32449, -32364, -32270, -32165, -32051, -31928, -31794, -31651, -31498, -31336, -31164, -30982, -30791, -30591, -30382, -30163, -29935, -29697, -29451, -29196, -28932, -28659, -28378, -28087, -27788, -27481, -27166, -26842
	dw	-26510, -26169, -25821, -25465, -25101, -24730, -24351, -23965, -23571, -23170, -22762, -22348, -21926, -21498, -21063, -20621, -20174, -19720, -19260, -18795, -18324, -17847, -17364, -16877, -16384, -15886, -15384, -14876, -14365, -13848, -13328, -12804, -12275, -11743, -11207, -10668
	dw	-10126, -9581, -9032, -8481, -7928, -7371, -6813, -6253, -5690, -5126, -4561, -3994, -3426, -2856, -2286, -1715, -1144, -572, -1, 571, 1143, 1714, 2285, 2855, 3425, 3993, 4560, 5125, 5689, 6252, 6812, 7370, 7927, 8480, 9031, 9580
	dw	10125, 10667, 11206, 11742, 12274, 12803, 13327, 13847, 14364, 14875, 15383, 15885, 16383, 16876, 17363, 17846, 18323, 18794, 19259, 19719, 20173, 20620, 21062, 21497, 21925, 22347, 22761, 23169, 23570, 23964, 24350, 24729, 25100, 25464, 25820, 26168
	dw	26509, 26841, 27165, 27480, 27787, 28086, 28377, 28658, 28931, 29195, 29450, 29696, 29934, 30162, 30381, 30590, 30790, 30981, 31163, 31335, 31497, 31650, 31793, 31927, 32050, 32164, 32269, 32363, 32448, 32522, 32587, 32642, 32687, 32722, 32747, 32762

trig_TangentTable:		; Trig * 512, and not 32767... and maxed out
	dw	0, 8, 17, 26, 35, 44, 53, 62, 71, 81, 90, 99, 108, 118, 127, 137, 146, 156, 166, 176, 186, 196, 206, 217, 227, 238, 249, 260, 272, 283, 295, 307, 319, 332, 345, 358
	dw	371, 385, 400, 414, 429, 445, 461, 477, 494, 511, 530, 549, 568, 588, 610, 632, 655, 679, 704, 731, 759, 788, 819, 852, 886, 923, 962, 1004, 1049, 1097, 1149, 1206, 1267, 1333, 1406, 1486
	dw	1575, 1674, 1785, 1910, 2053, 2217, 2408, 2634, 2903, 3232, 3643, 4169, 4871, 5852, 7321, 9769, 14661, 29332, 32767, -29333, -14662, -9770, -7322, -5853, -4872, -4170, -3644, -3233, -2904, -2635, -2409, -2218, -2054, -1911, -1786, -1675
	dw	-1576, -1487, -1407, -1334, -1268, -1207, -1150, -1098, -1050, -1005, -963, -924, -887, -853, -820, -789, -760, -732, -705, -680, -656, -633, -611, -589, -569, -550, -531, -513, -495, -478, -462, -446, -430, -415, -401, -386
	dw	-372, -359, -346, -333, -320, -308, -296, -284, -273, -261, -250, -239, -228, -218, -207, -197, -187, -177, -167, -157, -147, -138, -128, -119, -109, -100, -91, -82, -72, -63, -54, -45, -36, -27, -18, -9
	dw	-1, 8, 17, 26, 35, 44, 53, 62, 71, 81, 90, 99, 108, 118, 127, 137, 146, 156, 166, 176, 186, 196, 206, 217, 227, 238, 249, 260, 272, 283, 295, 307, 319, 332, 345, 358
	dw	371, 385, 400, 414, 429, 445, 461, 477, 494, 511, 530, 549, 568, 588, 610, 632, 655, 679, 704, 731, 759, 788, 819, 852, 886, 923, 962, 1004, 1049, 1097, 1149, 1206, 1267, 1333, 1406, 1486
	dw	1575, 1674, 1785, 1910, 2053, 2217, 2408, 2634, 2903, 3232, 3643, 4169, 4871, 5852, 7321, 9769, 14661, 29332, 32767, -29333, -14662, -9770, -7322, -5853, -4872, -4170, -3644, -3233, -2904, -2635, -2409, -2218, -2054, -1911, -1786, -1675
	dw	-1576, -1487, -1407, -1334, -1268, -1207, -1150, -1098, -1050, -1005, -963, -924, -887, -853, -820, -789, -760, -732, -705, -680, -656, -633, -611, -589, -569, -550, -531, -513, -495, -478, -462, -446, -430, -415, -401, -386
	dw	-372, -359, -346, -333, -320, -308, -296, -284, -273, -261, -250, -239, -228, -218, -207, -197, -187, -177, -167, -157, -147, -138, -128, -119, -109, -100, -91, -82, -72, -63, -54, -45, -36, -27, -18, -9


	.code

;-----------------------------------------------------------------------------------------[ sin imm
vm_sinimm		proc	STDCALL, ptrMachine:DWORD
	mov	esi, ptrMachine
	mov	edi, [esi].reg_ip
	inc	edi

	push	edi
	push	esi
	call	internals_ReadValue			; Gets 32 bit value after opcode

	xor	edx, edx
	mov	ecx, 360
	div	ecx
	shl	edx, 1					; EDX == Pointer in sine table
	add	edx, offset trig_SineTable
	movzx	eax, word ptr [edx]

	mov	[esi].reg_acc, eax

	add	[esi].reg_ip, 5
	ret
vm_sinimm		endp

;-----------------------------------------------------------------------------------------[ sin cnt
vm_sincnt		proc	STDCALL, ptrMachine:DWORD
	mov	esi, ptrMachine
	mov	eax, [esi].reg_cnt
	xor	edx, edx
	mov	ecx, 360
	div	ecx
	shl	edx, 1					; EDX == Pointer in sine table
	add	edx, offset trig_SineTable
	movzx	eax, word ptr [edx]

	mov	[esi].reg_acc, eax

	inc	[esi].reg_ip
	ret
vm_sincnt		endp

;-----------------------------------------------------------------------------------------[ sin var
vm_sinvar		proc	STDCALL, ptrMachine:DWORD
	mov	esi, ptrMachine
	mov	edi, [esi].reg_ip
	inc	edi

	push	edi
	push	esi
	call	internals_ReadValue			; Gets 32 bit value after opcode
	push	eax
	push	esi
	call	internals_ReadValue			; Gets 32 bit value after opcode

	xor	edx, edx
	mov	ecx, 360
	div	ecx
	shl	edx, 1					; EDX == Pointer in sine table
	add	edx, offset trig_SineTable
	movzx	eax, word ptr [edx]

	mov	[esi].reg_acc, eax

	add	[esi].reg_ip, 5
	ret
vm_sinvar		endp

;-----------------------------------------------------------------------------------------[ cos imm
vm_cosimm		proc	STDCALL, ptrMachine:DWORD
	mov	esi, ptrMachine
	mov	edi, [esi].reg_ip
	inc	edi

	push	edi
	push	esi
	call	internals_ReadValue			; Gets 32 bit value after opcode

	xor	edx, edx
	mov	ecx, 360
	div	ecx
	shl	edx, 1					; EDX == Pointer in cose table
	add	edx, offset trig_CosineTable
	movzx	eax, word ptr [edx]

	mov	[esi].reg_acc, eax

	add	[esi].reg_ip, 5
	ret
vm_cosimm		endp

;-----------------------------------------------------------------------------------------[ cos cnt
vm_coscnt		proc	STDCALL, ptrMachine:DWORD
	mov	esi, ptrMachine
	mov	eax, [esi].reg_cnt
	xor	edx, edx
	mov	ecx, 360
	div	ecx
	shl	edx, 1					; EDX == Pointer in cose table
	add	edx, offset trig_CosineTable
	movzx	eax, word ptr [edx]

	mov	[esi].reg_acc, eax

	inc	[esi].reg_ip
	ret
vm_coscnt		endp

;-----------------------------------------------------------------------------------------[ cos var
vm_cosvar		proc	STDCALL, ptrMachine:DWORD
	mov	esi, ptrMachine
	mov	edi, [esi].reg_ip
	inc	edi

	push	edi
	push	esi
	call	internals_ReadValue			; Gets 32 bit value after opcode
	push	eax
	push	esi
	call	internals_ReadValue			; Gets 32 bit value after opcode

	xor	edx, edx
	mov	ecx, 360
	div	ecx
	shl	edx, 1					; EDX == Pointer in cose table
	add	edx, offset trig_CosineTable
	movzx	eax, word ptr [edx]

	mov	[esi].reg_acc, eax

	add	[esi].reg_ip, 5
	ret
vm_cosvar		endp

;-----------------------------------------------------------------------------------------[ tan imm
vm_tanimm		proc	STDCALL, ptrMachine:DWORD
	mov	esi, ptrMachine
	mov	edi, [esi].reg_ip
	inc	edi

	push	edi
	push	esi
	call	internals_ReadValue			; Gets 32 bit value after opcode

	xor	edx, edx
	mov	ecx, 360
	div	ecx
	shl	edx, 1					; EDX == Pointer in tane table
	add	edx, offset trig_TangentTable
	movzx	eax, word ptr [edx]

	mov	[esi].reg_acc, eax

	add	[esi].reg_ip, 5
	ret
vm_tanimm		endp

;-----------------------------------------------------------------------------------------[ tan cnt
vm_tancnt		proc	STDCALL, ptrMachine:DWORD
	mov	esi, ptrMachine
	mov	eax, [esi].reg_cnt
	xor	edx, edx
	mov	ecx, 360
	div	ecx
	shl	edx, 1					; EDX == Pointer in tane table
	add	edx, offset trig_TangentTable
	movzx	eax, word ptr [edx]

	mov	[esi].reg_acc, eax

	inc	[esi].reg_ip
	ret
vm_tancnt		endp

;-----------------------------------------------------------------------------------------[ tan var
vm_tanvar		proc	STDCALL, ptrMachine:DWORD
	mov	esi, ptrMachine
	mov	edi, [esi].reg_ip
	inc	edi

	push	edi
	push	esi
	call	internals_ReadValue			; Gets 32 bit value after opcode
	push	eax
	push	esi
	call	internals_ReadValue			; Gets 32 bit value after opcode

	xor	edx, edx
	mov	ecx, 360
	div	ecx
	shl	edx, 1					; EDX == Pointer in tane table
	add	edx, offset trig_TangentTable
	movzx	eax, word ptr [edx]

	mov	[esi].reg_acc, eax

	add	[esi].reg_ip, 5
	ret
vm_tanvar		endp


